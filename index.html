<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Community Ball – Platzhalter-Hotspots (fix)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script type="module" src="https://unpkg.com/@google/model-viewer@3.4.0/dist/model-viewer.min.js"></script>
  <style>
    html, body { margin:0; height:100%; background:#000; color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif }
    model-viewer { width:100%; height:100%; }

    .sat {
      width:84px; height:84px;
      border-radius:12px;
      background:#fff;
      border:2px solid #0ff;
      box-shadow:0 0 14px rgba(0,255,255,.45);
      display:flex; align-items:center; justify-content:center;
      font-weight:800; color:#000;
      cursor:pointer; user-select:none;
      transition:transform .15s ease;
    }
    .sat:hover { transform:scale(1.08) }

    .controls {
      position:fixed; right:12px; bottom:12px; display:flex; gap:8px;
      z-index:9999; background:rgba(0,0,0,.5); padding:8px 10px; border-radius:12px; border:1px solid #333;
    }
    .btn {
      background:#111; color:#0ff; border:1px solid #044; border-radius:10px;
      padding:10px 14px; font-weight:700; cursor:pointer; user-select:none;
      font-size:18px; line-height:1;
    }
    .btn:active { transform:scale(.98) }
    .label { font-size:12px; opacity:.9; margin-left:6px }
    input[type="range"]{ accent-color:#0ff }
  </style>
</head>
<body>
  <model-viewer id="viewer"
    src="ball4.glb"
    alt="Community Ball"
    camera-controls
    auto-rotate
    interaction-prompt="none"
    exposure="1"
    background-color="#000"
    camera-orbit="0deg 65deg 120m"
    min-camera-orbit="auto auto 10m"
    max-camera-orbit="auto auto 400m">
  </model-viewer>

  <div class="controls">
    <div class="btn" id="zoomOut">−</div>
    <div class="btn" id="zoomIn">+</div>
    <label class="label">Radius:
      <input id="radius" type="range" min="20" max="200" step="5" value="80">
      <span id="rval">80</span>m
    </label>
  </div>

  <script>
    const viewer = document.getElementById('viewer');
    const slider = document.getElementById('radius');
    const rval   = document.getElementById('rval');

    const COUNT = 10;         // 10 Platzhalter
    let RADIUS  = parseFloat(slider.value); // Abstand vom Ballzentrum in Metern

    function fibonacciSphere(n, r){
      const pts=[], PHI=(1+Math.sqrt(5))/2;
      for (let i=0;i<n;i++){
        const t=i/n, inc=Math.PI*2*(1-1/PHI);
        const z=1-2*t, rad=Math.sqrt(1 - z*z), th=inc*i;
        pts.push([Math.cos(th)*rad*r, Math.sin(th)*rad*r, z*r]);
      }
      return pts;
    }
    function clearHotspots(){
      [...viewer.querySelectorAll('[slot^="hotspot-"]')].forEach(n=>n.remove());
    }
    function buildPlaceholders(){
      clearHotspots();
      const pts = fibonacciSphere(COUNT, RADIUS);
      for (let i=0;i<COUNT;i++){
        const el = document.createElement('div');
        el.className = 'sat';
        el.textContent = i+1;
        el.slot = `hotspot-${i}`;
        const [x,y,z] = pts[i];
        el.dataset.position = `${x} ${y} ${z}`;
        el.dataset.normal   = `${x} ${y} ${z}`;
        el.setAttribute('data-visibility-attribute','visible');
        el.addEventListener('click', (e)=>{
          e.stopPropagation();
          alert(`Hotspot #${i+1}\nPos: ${x.toFixed(1)} ${y.toFixed(1)} ${z.toFixed(1)} m`);
        });
        viewer.appendChild(el);
      }
      console.log('Hotspots aufgebaut. RADIUS =', RADIUS);
    }

    function changeZoom(delta){
      const o  = viewer.getCameraOrbit();
      const r  = parseFloat(o.radius);
      const nr = Math.max(10, Math.min(400, r + delta));
      viewer.cameraOrbit = `${o.theta} ${o.phi} ${nr}m`;
    }
    document.getElementById('zoomIn').addEventListener('click',  ()=>changeZoom(-10));
    document.getElementById('zoomOut').addEventListener('click', ()=>changeZoom(+10));

    slider.addEventListener('input', ()=>{
      RADIUS = parseFloat(slider.value);
      rval.textContent = RADIUS;
      buildPlaceholders();
    });

    viewer.addEventListener('load', buildPlaceholders);
  </script>
</body>
</html>
